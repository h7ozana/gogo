#깃클론 이후 기본 https://brunch.co.kr/@topasvga/3585
aws eks --region $(terraform output -raw region) update-kubeconfig --name $(terraform output -raw cluster_name)
kubectl cluster-info
kubectl get nodes
kubectl get namespace

#참고 1 https://velog.io/@junsugi/Argo-CD-%EB%A5%BC-AWS-EKS-%EC%97%90-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0
#참고 2 아래 2개


# 아르고시작 https://argo-cd.readthedocs.io/en/stable/getting_started/

kubectl create namespace argocd
kubectl get namespace
kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
kubectl get all -n argocd

---------------------------------------------------------------
git clone https://github.com/DNXLabs/terraform-aws-eks-lb-controller
choco install kubernetes-helm
--즉시 익잼플 eks-1.27맞추기 / 배리어블 tf 숫자맞추기.리전


#gitbash에서 쭉해보기
export KUBE_CONFIG_PATH="/c/Users/soldesk/.kube/config"

helm upgrade -i aws-load-balancer-controller eks/aws-load-balancer-controller --namespace kube-system --set clusterName=education-eks-cVKrwBCd --set serviceAccount.create=false --set serviceAccount.name=alb-ingress-controller-sa

alb가서 apply이후 실제 생성 확인 및 아래 컨트롤러 확인 
확인되면 www레코드 생성-로밸연결 하고 www대상으로 인증서 보내보기
#어플라이시 필요한내용
aws eks describe-cluster --name education-eks-cVKrwBCd --region ap-northeast-2


컨트롤러가 설치되어 있는지 확인합니다.
kubectl get deployment -n kube-system aws-load-balancer-controller
##파워쉘
helm repo add eks https://aws.github.io/eks-charts
helm upgrade -i aws-load-balancer-controller eks/aws-load-balancer-controller \
  --namespace kube-system \
  --set clusterName=education-eks-pe4Qp48L \
  --set serviceAccount.create=false \
  --set serviceAccount.name=alb-ingress-controller-sa

eksctl utils install alb-ingress-controller --region ap-northeast-2 --cluster education-eks-pe4Qp48L --approve

kubectl apply -f argolb.yaml -n argocd
kubectl get ingress --all-namespaces

# argoCD Cli 설치 windows powershell 실행 https://blog.naver.com/rkttndk/223225663234
#https://nyyang.tistory.com/114 자세한설명

$version = (Invoke-RestMethod https://api.github.com/repos/argoproj/argo-cd/releases/latest).tag_name
$url = "https://github.com/argoproj/argo-cd/releases/download/" + $version + "/argocd-windows-amd64.exe"
$output = "argocd.exe"
Invoke-WebRequest -Uri $url -OutFile $output
mv .\argocd.exe C:\Users\Woo\Downloads

#CMD
cd C:\Users\Woo\Downloads
argocd
kubectl port-forward svc/argocd-server -n argocd 8080:443
https://127.0.0.1:8080/
kubectl describe svc argocd-server -n argocd

#비밀번호 추출
kubectl get secret argocd-initial-admin-secret -n argocd -o jsonpath="{.data.password}" | ForEach-Object { [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($_)) }


kubectl patch svc argocd-server -n argocd -p '{"spec":{"type":"LoadBalancer"}}'

